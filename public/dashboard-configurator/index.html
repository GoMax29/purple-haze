<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Configuration M√©t√©o</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        color: #2c3e50;
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-align: center;
      }

      .header p {
        color: #7f8c8d;
        text-align: center;
        font-size: 1.1rem;
      }

      .card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
      }

      .card h3 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: 1.4rem;
        border-bottom: 3px solid #3498db;
        padding-bottom: 10px;
      }

      .parameter-config {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .horizon-config {
        border: 2px solid #ecf0f1;
        border-radius: 10px;
        padding: 20px;
        background: linear-gradient(145deg, #f8f9fa, #e9ecef);
      }

      .horizon-config h4 {
        color: #34495e;
        margin-bottom: 15px;
        font-size: 1.1rem;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        color: #555;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .form-group select,
      .form-group input {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s ease;
      }

      .form-group select:focus,
      .form-group input:focus {
        outline: none;
        border-color: #3498db;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
      }

      .models-selector {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-bottom: 15px;
      }

      .model-checkbox {
        display: flex;
        align-items: center;
        padding: 8px;
        background: #fff;
        border: 2px solid #ecf0f1;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .model-checkbox:hover {
        border-color: #3498db;
        background: #ebf3fd;
      }

      .model-checkbox input[type="checkbox"] {
        margin-right: 8px;
        transform: scale(1.2);
      }

      .model-checkbox.checked {
        border-color: #27ae60;
        background: #d5f4e6;
      }

      .weights-config {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-top: 10px;
        display: none;
      }

      .weights-config.show {
        display: block;
      }

      .weight-input {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .weight-input label {
        min-width: 100px;
        margin-right: 10px;
        margin-bottom: 0;
      }

      .weight-input input {
        flex: 1;
        margin: 0;
      }

      .controls {
        display: flex;
        gap: 15px;
        justify-content: center;
        margin-top: 30px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 12px 24px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        min-width: 140px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
      }

      .btn-success {
        background: linear-gradient(135deg, #27ae60, #229954);
        color: white;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        color: white;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
      }

      .status {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
        font-weight: 600;
        display: none;
      }

      .status.success {
        background: #d5f4e6;
        color: #27ae60;
        border: 2px solid #27ae60;
      }

      .status.error {
        background: #fadbd8;
        color: #e74c3c;
        border: 2px solid #e74c3c;
      }

      .json-preview {
        background: #2c3e50;
        color: #ecf0f1;
        padding: 20px;
        border-radius: 10px;
        font-family: "Courier New", monospace;
        font-size: 14px;
        overflow-x: auto;
        max-height: 400px;
        overflow-y: auto;
      }

      .info-panel {
        background: linear-gradient(135deg, #f39c12, #e67e22);
        color: white;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 20px;
      }

      .info-panel h3 {
        margin-bottom: 10px;
        color: white;
        border: none;
        padding: 0;
      }

      .methods-info {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
      }

      .method-card {
        background: rgba(255, 255, 255, 0.1);
        padding: 15px;
        border-radius: 8px;
        backdrop-filter: blur(5px);
      }

      .method-card h4 {
        color: #fff;
        margin-bottom: 8px;
      }

      .method-card p {
        color: #f8f9fa;
        font-size: 14px;
        line-height: 1.4;
      }

      @media (max-width: 768px) {
        .parameter-config {
          grid-template-columns: 1fr;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }

        .btn {
          width: 100%;
          max-width: 300px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>üåä Dashboard Configuration M√©t√©o</h1>
        <p>
          Configurez les strat√©gies de pr√©vision pour votre application
          m√©t√©o/surf Bretagne
        </p>
      </div>

      <div class="info-panel">
        <h3>üìö Guide des M√©thodes de Traitement</h3>
        <div class="methods-info">
          <div class="method-card">
            <h4>Moyenne (mean)</h4>
            <p>
              Calcule la moyenne arithm√©tique simple de tous les mod√®les
              s√©lectionn√©s.
            </p>
          </div>
          <div class="method-card">
            <h4>M√©diane (median)</h4>
            <p>
              Valeur centrale qui r√©siste mieux aux valeurs aberrantes que la
              moyenne.
            </p>
          </div>
          <div class="method-card">
            <h4>Moyenne Tronqu√©e</h4>
            <p>
              Supprime un pourcentage des valeurs extr√™mes avant de calculer la
              moyenne.
            </p>
          </div>
          <div class="method-card">
            <h4>Moyenne Pond√©r√©e</h4>
            <p>
              Attribue des poids diff√©rents aux mod√®les selon leur fiabilit√©.
            </p>
          </div>
          <div class="method-card">
            <h4>Gaussienne Pond√©r√©e</h4>
            <p>
              Poids calcul√©s selon une distribution gaussienne centr√©e sur la
              m√©diane.
            </p>
          </div>
        </div>
      </div>

      <div class="parameter-config">
        <div class="card">
          <h3>üå°Ô∏è Temp√©rature</h3>
          <div id="temperature-config"></div>
        </div>

        <div class="card">
          <h3>üåßÔ∏è Pr√©cipitations</h3>
          <div id="precipitation-config"></div>
        </div>

        <div class="card">
          <h3>üí® Vent</h3>
          <div id="wind-config"></div>
        </div>

        <div class="card">
          <h3>üå¨Ô∏è Pression</h3>
          <div id="pressure-config"></div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-secondary" onclick="loadDefaultConfig()">
          üîÑ Configuration par d√©faut
        </button>
        <button class="btn btn-primary" onclick="previewConfig()">
          üëÅÔ∏è Aper√ßu JSON
        </button>
        <button class="btn btn-success" onclick="exportConfig()">
          üíæ Exporter Configuration
        </button>
      </div>

      <div id="status" class="status"></div>

      <div class="card" id="preview-panel" style="display: none">
        <h3>üìÑ Aper√ßu de la Configuration JSON</h3>
        <div id="json-preview" class="json-preview"></div>
      </div>
    </div>

    <script>
      // Configuration des mod√®les m√©t√©o disponibles
      const WEATHER_MODELS = [
        "arome",
        "arome_hd",
        "graphcast",
        "icon_eu",
        "ecmwf",
        "ukmo",
        "gfs",
        "knmi",
        "arp",
        "gem",
        "icon_global",
      ];

      // M√©thodes de traitement disponibles
      const PROCESSING_METHODS = [
        { value: "mean", label: "Moyenne" },
        { value: "median", label: "M√©diane" },
        { value: "mean_trimmed", label: "Moyenne tronqu√©e" },
        { value: "weighted_average", label: "Moyenne pond√©r√©e" },
        { value: "gaussian_weighted", label: "Gaussienne pond√©r√©e" },
        { value: "max", label: "Maximum" },
        { value: "min", label: "Minimum" },
      ];

      // Horizons temporels par param√®tre
      const TIME_HORIZONS = {
        temperature: ["0-48h", "48-120h", "120h+"],
        precipitation: ["0-24h", "24-72h", "72h+"],
        wind: ["0-48h", "48-120h", "120h+"],
        pressure: ["0-120h", "120h+"],
      };

      let currentConfig = {};

      // Initialisation au chargement de la page
      document.addEventListener("DOMContentLoaded", function () {
        loadDefaultConfig();
      });

      function createParameterConfig(parameter) {
        const horizons = TIME_HORIZONS[parameter];
        const container = document.getElementById(`${parameter}-config`);
        container.innerHTML = "";

        horizons.forEach((horizon) => {
          const horizonDiv = document.createElement("div");
          horizonDiv.className = "horizon-config";
          horizonDiv.innerHTML = `
                    <h4>üìÖ ${horizon}</h4>
                    
                    <div class="form-group">
                        <label>Mod√®les m√©t√©o :</label>
                        <div class="models-selector" id="${parameter}-${horizon}-models">
                            ${WEATHER_MODELS.map(
                              (model) => `
                                <div class="model-checkbox" onclick="toggleModel('${parameter}', '${horizon}', '${model}')">
                                    <input type="checkbox" id="${parameter}-${horizon}-${model}">
                                    <label for="${parameter}-${horizon}-${model}">${model}</label>
                                </div>
                            `
                            ).join("")}
                        </div>
                    </div>

                    <div class="form-group">
                        <label>M√©thode de traitement :</label>
                        <select id="${parameter}-${horizon}-method" onchange="onMethodChange('${parameter}', '${horizon}')">
                            ${PROCESSING_METHODS.map(
                              (method) => `
                                <option value="${method.value}">${method.label}</option>
                            `
                            ).join("")}
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Param√®tre de trim (pour moyenne tronqu√©e) :</label>
                        <input type="number" id="${parameter}-${horizon}-trim" 
                               min="0" max="0.5" step="0.05" value="0.2" 
                               placeholder="0.2">
                    </div>

                    <div class="form-group">
                        <label>Sigma (pour gaussienne) :</label>
                        <input type="number" id="${parameter}-${horizon}-sigma" 
                               min="0.1" max="5" step="0.1" value="1.0" 
                               placeholder="1.0">
                    </div>

                    <div class="weights-config" id="${parameter}-${horizon}-weights">
                        <label><strong>Poids par mod√®le :</strong></label>
                        <div id="${parameter}-${horizon}-weights-inputs"></div>
                    </div>
                `;
          container.appendChild(horizonDiv);
        });
      }

      function toggleModel(parameter, horizon, model) {
        const checkbox = document.getElementById(
          `${parameter}-${horizon}-${model}`
        );
        checkbox.checked = !checkbox.checked;

        const container = checkbox.closest(".model-checkbox");
        container.classList.toggle("checked", checkbox.checked);

        updateWeightsInputs(parameter, horizon);
      }

      function onMethodChange(parameter, horizon) {
        const method = document.getElementById(
          `${parameter}-${horizon}-method`
        ).value;
        const weightsConfig = document.getElementById(
          `${parameter}-${horizon}-weights`
        );

        if (method === "weighted_average") {
          weightsConfig.classList.add("show");
          updateWeightsInputs(parameter, horizon);
        } else {
          weightsConfig.classList.remove("show");
        }
      }

      function updateWeightsInputs(parameter, horizon) {
        const selectedModels = WEATHER_MODELS.filter(
          (model) =>
            document.getElementById(`${parameter}-${horizon}-${model}`).checked
        );

        const weightsContainer = document.getElementById(
          `${parameter}-${horizon}-weights-inputs`
        );
        weightsContainer.innerHTML = "";

        selectedModels.forEach((model) => {
          const weightDiv = document.createElement("div");
          weightDiv.className = "weight-input";
          weightDiv.innerHTML = `
                    <label>${model}:</label>
                    <input type="number" id="${parameter}-${horizon}-weight-${model}" 
                           min="0" max="1" step="0.1" value="0.5" 
                           placeholder="0.5">
                `;
          weightsContainer.appendChild(weightDiv);
        });
      }

      function loadDefaultConfig() {
        // Configuration par d√©faut
        const defaultConfig = {
          temperature: {
            "0-48h": {
              models: ["arome", "graphcast", "icon_eu"],
              method: "mean_trimmed",
              trim_percent: 0.2,
            },
            "48-120h": {
              models: ["ecmwf", "ukmo", "gfs"],
              method: "median",
            },
            "120h+": {
              models: ["ecmwf", "gfs", "gem"],
              method: "weighted_average",
              weights: { ecmwf: 0.5, gfs: 0.3, gem: 0.2 },
            },
          },
          precipitation: {
            "0-24h": {
              models: ["arome_hd", "knmi", "arp"],
              method: "weighted_average",
              weights: { arome_hd: 0.5, knmi: 0.3, arp: 0.2 },
            },
            "24-72h": {
              models: ["arome", "icon_eu", "ecmwf"],
              method: "mean_trimmed",
              trim_percent: 0.15,
            },
            "72h+": {
              models: ["ecmwf", "gfs", "ukmo"],
              method: "median",
            },
          },
          wind: {
            "0-48h": {
              models: ["arome", "icon_eu", "knmi", "graphcast"],
              method: "median",
            },
            "48-120h": {
              models: ["ecmwf", "ukmo", "gfs"],
              method: "gaussian_weighted",
              sigma: 1.2,
            },
            "120h+": {
              models: ["ecmwf", "gfs", "gem", "icon_global"],
              method: "mean_trimmed",
              trim_percent: 0.25,
            },
          },
          pressure: {
            "0-120h": {
              models: ["ecmwf", "gfs", "arome", "ukmo"],
              method: "gaussian_weighted",
              sigma: 1.5,
            },
            "120h+": {
              models: ["ecmwf", "gfs", "gem"],
              method: "weighted_average",
              weights: { ecmwf: 0.6, gfs: 0.25, gem: 0.15 },
            },
          },
        };

        currentConfig = defaultConfig;

        // Cr√©er l'interface pour chaque param√®tre
        Object.keys(defaultConfig).forEach((parameter) => {
          createParameterConfig(parameter);
          loadParameterConfig(parameter, defaultConfig[parameter]);
        });

        showStatus("Configuration par d√©faut charg√©e", "success");
      }

      function loadParameterConfig(parameter, paramConfig) {
        Object.keys(paramConfig).forEach((horizon) => {
          const config = paramConfig[horizon];

          // Charger les mod√®les s√©lectionn√©s
          WEATHER_MODELS.forEach((model) => {
            const checkbox = document.getElementById(
              `${parameter}-${horizon}-${model}`
            );
            if (checkbox) {
              checkbox.checked = config.models.includes(model);
              checkbox
                .closest(".model-checkbox")
                .classList.toggle("checked", checkbox.checked);
            }
          });

          // Charger la m√©thode
          const methodSelect = document.getElementById(
            `${parameter}-${horizon}-method`
          );
          if (methodSelect) {
            methodSelect.value = config.method;
            onMethodChange(parameter, horizon);
          }

          // Charger les param√®tres sp√©cifiques
          if (config.trim_percent) {
            const trimInput = document.getElementById(
              `${parameter}-${horizon}-trim`
            );
            if (trimInput) trimInput.value = config.trim_percent;
          }

          if (config.sigma) {
            const sigmaInput = document.getElementById(
              `${parameter}-${horizon}-sigma`
            );
            if (sigmaInput) sigmaInput.value = config.sigma;
          }

          // Charger les poids
          if (config.weights) {
            setTimeout(() => {
              Object.keys(config.weights).forEach((model) => {
                const weightInput = document.getElementById(
                  `${parameter}-${horizon}-weight-${model}`
                );
                if (weightInput) weightInput.value = config.weights[model];
              });
            }, 100);
          }
        });
      }

      function collectCurrentConfig() {
        const config = {};

        Object.keys(TIME_HORIZONS).forEach((parameter) => {
          config[parameter] = {};

          TIME_HORIZONS[parameter].forEach((horizon) => {
            const selectedModels = WEATHER_MODELS.filter(
              (model) =>
                document.getElementById(`${parameter}-${horizon}-${model}`)
                  ?.checked
            );

            const method = document.getElementById(
              `${parameter}-${horizon}-method`
            )?.value;

            if (selectedModels.length > 0 && method) {
              const horizonConfig = {
                models: selectedModels,
                method: method,
              };

              // Ajouter les param√®tres sp√©cifiques selon la m√©thode
              if (method === "mean_trimmed") {
                const trimValue = document.getElementById(
                  `${parameter}-${horizon}-trim`
                )?.value;
                if (trimValue)
                  horizonConfig.trim_percent = parseFloat(trimValue);
              }

              if (method === "gaussian_weighted") {
                const sigmaValue = document.getElementById(
                  `${parameter}-${horizon}-sigma`
                )?.value;
                if (sigmaValue) horizonConfig.sigma = parseFloat(sigmaValue);
              }

              if (method === "weighted_average") {
                const weights = {};
                selectedModels.forEach((model) => {
                  const weightInput = document.getElementById(
                    `${parameter}-${horizon}-weight-${model}`
                  );
                  if (weightInput && weightInput.value) {
                    weights[model] = parseFloat(weightInput.value);
                  }
                });
                if (Object.keys(weights).length > 0) {
                  horizonConfig.weights = weights;
                }
              }

              config[parameter][horizon] = horizonConfig;
            }
          });
        });

        return config;
      }

      function previewConfig() {
        const config = collectCurrentConfig();
        currentConfig = config;

        const previewPanel = document.getElementById("preview-panel");
        const jsonPreview = document.getElementById("json-preview");

        jsonPreview.textContent = JSON.stringify(config, null, 2);
        previewPanel.style.display = "block";

        previewPanel.scrollIntoView({ behavior: "smooth" });
      }

      function exportConfig() {
        const config = collectCurrentConfig();

        // Ajouter les m√©tadonn√©es
        config.config_metadata = {
          version: "1.0.0",
          created_at: new Date().toISOString(),
          description: "Configuration g√©n√©r√©e par le dashboard",
          last_modified: new Date().toISOString(),
          author: "Dashboard User",
        };

        const jsonString = JSON.stringify(config, null, 2);

        // Cr√©er un fichier pour t√©l√©chargement
        const blob = new Blob([jsonString], { type: "application/json" });
        const url = URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "forecast_strategy.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);

        URL.revokeObjectURL(url);

        showStatus("Configuration export√©e avec succ√®s !", "success");
      }

      function showStatus(message, type) {
        const status = document.getElementById("status");
        status.textContent = message;
        status.className = `status ${type}`;
        status.style.display = "block";

        setTimeout(() => {
          status.style.display = "none";
        }, 4000);
      }
    </script>
  </body>
</html>
